# üîÑ –í–æ–∫–∑–∞–ª.–¢–ï–• ‚Äî –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (UML Sequence Diagrams)

### 1. –ü—Ä–æ–¥–∞–∂–∞ –±–∏–ª–µ—Ç–∞

```mermaid
sequenceDiagram
    participant –ö–∞—Å—Å–∏—Ä
    participant POS as POS (Tauri)
    participant Ticket as ticket.vokzal.tech
    participant Fiscal as fiscal.vokzal.tech
    participant Printer as –ü—Ä–∏–Ω—Ç–µ—Ä
    participant –ö–ö–¢ as –ö–ö–¢ (–ê–¢–û–õ)

    –ö–∞—Å—Å–∏—Ä->>POS: –í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–π—Å, –º–µ—Å—Ç–æ
    POS->>Ticket: GET /trips/{id}
    Ticket-->>POS: –î–∞–Ω–Ω—ã–µ —Ä–µ–π—Å–∞
    –ö–∞—Å—Å–∏—Ä->>POS: –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ, –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
    POS->>Fiscal: POST /fiscal/receipt (–ø—Ä–∏—Ö–æ–¥)
    Fiscal->>–ö–ö–¢: –ü–µ—á–∞—Ç—å —á–µ–∫–∞
    –ö–ö–¢-->>Fiscal: –£—Å–ø–µ—Ö
    Fiscal-->>POS: URL —á–µ–∫–∞
    POS->>Ticket: POST /tickets/sell
    Ticket-->>POS: ticket_id, QR
    POS->>Printer: –ü–µ—á–∞—Ç—å –±–∏–ª–µ—Ç–∞
    Printer-->>–ö–∞—Å—Å–∏—Ä: –ë–∏–ª–µ—Ç —Ä–∞—Å–ø–µ—á–∞—Ç–∞–Ω
2. –í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–∞sequenceDiagram
    participant –ö–∞—Å—Å–∏—Ä
    participant POS
    participant Ticket
    participant Audit as audit.vokzal.tech
    participant Fiscal
    participant –ö–ö–¢

    –ö–∞—Å—Å–∏—Ä->>POS: –°–∫–∞–Ω–∏—Ä—É–µ—Ç QR –±–∏–ª–µ—Ç–∞
    POS->>Ticket: GET /tickets/{id}
    Ticket-->>POS: –î–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç–∞, —Å—Ç–∞—Ç—É—Å
    POS->>Ticket: –ü—Ä–æ–≤–µ—Ä–∫–∞: –±—ã–ª –ª–∏ –ø–æ—Å–∞–∂–µ–Ω?
    Ticket-->>POS: –î–∞/–ù–µ—Ç
    alt –ï—Å–ª–∏ –Ω–µ –ø–æ—Å–∞–∂–µ–Ω
        POS->>Fiscal: POST /fiscal/refund
        Fiscal->>–ö–ö–¢: –ü–µ—á–∞—Ç—å —á–µ–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
        –ö–ö–¢-->>Fiscal: –£—Å–ø–µ—Ö
        Fiscal-->>POS: URL —á–µ–∫–∞
        POS->>Ticket: PATCH /tickets/{id}/return
        Ticket->>Audit: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
        Audit-->>Ticket: –£—Å–ø–µ—Ö
        Ticket-->>POS: –í–æ–∑–≤—Ä–∞—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
    else –ï—Å–ª–∏ –ø–æ—Å–∞–∂–µ–Ω
        POS-->>–ö–∞—Å—Å–∏—Ä: –í–æ–∑–≤—Ä–∞—Ç –∑–∞–ø—Ä–µ—â—ë–Ω
    end
3. –ù–∞—á–∞–ª–æ –ø–æ—Å–∞–¥–∫–∏sequenceDiagram
    participant –î–∏—Å–ø–µ—Ç—á–µ—Ä
    participant Admin as admin.vokzal.tech
    participant Board as board.vokzal.tech
    participant Ticket
    participant PA as –ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–æ–±–æ—Ç

    –î–∏—Å–ø–µ—Ç—á–µ—Ä->>Admin: –ù–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –ø–æ—Å–∞–¥–∫—É"
    Admin->>Ticket: POST /boarding/start
    Ticket->>Ticket: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –Ω–∞ —Ä–µ–π—Å
    Ticket-->>Admin: –£—Å–ø–µ—Ö
    Admin->>Board: –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–æ
    Board-->>–¢–∞–±–ª–æ: "–ù–∞—á–∞–ª–∞—Å—å –ø–æ—Å–∞–¥–∫–∞"
    Admin->>PA: POST /announcements
    PA->>PA: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞ (TTS)
    PA-->>–ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞: "–ü–æ—Å–∞–¥–∫–∞ –Ω–∞ —Ä–µ–π—Å –≤ –ö–∞–∑–∞–Ω—å –Ω–∞—á–Ω—ë—Ç—Å—è —É –ø–µ—Ä—Ä–æ–Ω–∞ 3"
4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–æ–∫–∑–∞–ª–∞–º–∏sequenceDiagram
    participant –í–æ–∫–∑–∞–ª–ê
    participant API as api.vokzal.tech
    participant –í–æ–∫–∑–∞–ª–ë

    –í–æ–∫–∑–∞–ª–ê->>API: POST /sync/trip-status
    API->>API: –í–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    API->>–í–æ–∫–∑–∞–ª–ë: –í–µ–±—Ö—É–∫: —Ä–µ–π—Å –ø—Ä–∏–±—ã–ª
    –í–æ–∫–∑–∞–ª–ë->>API: GET /trips/{id}
    API-->>–í–æ–∫–∑–∞–ª–ë: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    –í–æ–∫–∑–∞–ª–ë->>–¢–∞–±–ª–æ: –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π–ú–æ–¥—É–ª—å–§—É–Ω–∫—Ü–∏—è–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤–í—ã—Å–æ–∫–∏–π–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–π—Å–æ–≤–í—ã—Å–æ–∫–∏–π–ü—Ä–æ—Ö–æ–¥—è—â–∏–µ —Ä–µ–π—Å—ã–°—Ä–µ–¥–Ω–∏–π–ü—Ä–æ–¥–∞–∂–∞–ü—Ä–æ–¥–∞–∂–∞ —Å –º–µ—Å—Ç–æ–º–í—ã—Å–æ–∫–∏–π–ü—Ä–æ–¥–∞–∂–∞ –±–µ–∑ –º–µ—Å—Ç–∞–í—ã—Å–æ–∫–∏–π–ê–Ω–æ–Ω–∏–º–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞–í—ã—Å–æ–∫–∏–π–í–æ–∑–≤—Ä–∞—Ç —Å —à—Ç—Ä–∞—Ñ–∞–º–∏–í—ã—Å–æ–∫–∏–π–ü–æ—Å–∞–¥–∫–∞–†—É—á–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è–í—ã—Å–æ–∫–∏–π–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –®–ö–°—Ä–µ–¥–Ω–∏–π–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤–í—ã—Å–æ–∫–∏–π–¢–∞–±–ª–æ–û–±—â–µ–µ —Ç–∞–±–ª–æ–í—ã—Å–æ–∫–∏–π–ü–µ—Ä—Ä–æ–Ω–Ω–æ–µ —Ç–∞–±–ª–æ–í—ã—Å–æ–∫–∏–π–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–í—ã—Å–æ–∫–∏–π–î–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä—Ä–æ–Ω–æ–≤–í—ã—Å–æ–∫–∏–π–û–ø–æ–≤–µ—â–µ–Ω–∏–µ (TTS)–°—Ä–µ–¥–Ω–∏–π–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏–í—ã—Å–æ–∫–∏–π–î–æ–∫—É–º–µ–Ω—Ç—ã–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ü–î-2–í—ã—Å–æ–∫–∏–π–ö–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã–°—Ä–µ–¥–Ω–∏–π–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏–ö–ö–¢ (–ê–¢–û–õ)–í—ã—Å–æ–∫–∏–π–≠–∫–≤–∞–π—Ä–∏–Ω–≥–í—ã—Å–æ–∫–∏–πTelegram-–±–æ—Ç—ã–°—Ä–µ–¥–Ω–∏–πYandex Maps–í—ã—Å–æ–∫–∏–π–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å–ê—É–¥–∏—Ç (152-–§–ó)–í—ã—Å–æ–∫–∏–π–§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è (54-–§–ó)–í—ã—Å–æ–∫–∏–πRBAC–í—ã—Å–æ–∫–∏–π