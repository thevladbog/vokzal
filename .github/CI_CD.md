# CI/CD Pipeline Documentation

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–ª—è –í–æ–∫–∑–∞–ª.–¢–ï–•.

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **GitHub Actions** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## üîÑ –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (Workflows)

### 1. Services CI (`services-ci.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫–∏ `main`, `develop`
- Pull Request –≤ `main`, `develop`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `services/**`

**–®–∞–≥–∏:**
1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã
2. **–õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Go 1.23
   - –ó–∞–ø—É—Å–∫ `golangci-lint`
   - –ó–∞–ø—É—Å–∫ unit-—Ç–µ—Å—Ç–æ–≤ —Å coverage
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –≤ Codecov
3. **–°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤:**
   - –°–±–æ—Ä–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - Push –≤ Docker Hub (—Ç–æ–ª—å–∫–æ –¥–ª—è main/develop)
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤ —á–µ—Ä–µ–∑ GitHub Actions Cache
4. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
   - Trivy –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ GitHub Security

**–ú–∞—Ç—Ä–∏—Ü–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:**
- auth, schedule, ticket, fiscal, payment
- board, notify, audit, document, geo

### 2. UI Applications CI (`ui-ci.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫–∏ `main`, `develop`
- Pull Request –≤ `main`, `develop`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `ui/**`

**–®–∞–≥–∏:**
1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
2. **–õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20
   - ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞
   - TypeScript type-check
   - Jest —Ç–µ—Å—Ç—ã —Å coverage
3. **–°–±–æ—Ä–∫–∞:**
   - –°–±–æ—Ä–∫–∞ production build
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
4. **Docker –æ–±—Ä–∞–∑—ã:**
   - –°–±–æ—Ä–∫–∞ –∏ push (—Ç–æ–ª—å–∫–æ –¥–ª—è main/develop)

**–ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:**
- admin-panel, board-display
- passenger-portal, controller-app

### 3. Agent CI (`agent-ci.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫–∏ `main`, `develop`
- Pull Request –≤ `main`, `develop`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `agent/**`

**–®–∞–≥–∏:**
1. **–õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
2. **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞:**
   - Linux (amd64)
   - Windows (amd64)
   - macOS (amd64, arm64)
3. **Release:**
   - –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release –ø—Ä–∏ —Ç–µ–≥–∞—Ö `v*`
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤

### 4. E2E Tests (`e2e-tests.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main`, `develop`
- Pull Request
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (nightly at 2 AM UTC)
- Manual dispatch

**–®–∞–≥–∏:**
1. **E2E —Ç–µ—Å—Ç—ã (Cypress):**
   - –ó–∞–ø—É—Å–∫ PostgreSQL, Redis, NATS —á–µ—Ä–µ–∑ services
   - –°—Ç–∞—Ä—Ç –≤—Å–µ—Ö Go —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ó–∞–ø—É—Å–∫ Cypress —Ç–µ—Å—Ç–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ screenshots/videos –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
2. **Load —Ç–µ—Å—Ç—ã (k6):**
   - –¢–æ–ª—å–∫–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 5. Deploy (`deploy.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main`
- –¢–µ–≥–∏ `v*.*.*`
- Manual dispatch —Å –≤—ã–±–æ—Ä–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–®–∞–≥–∏:**
1. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤:**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ kubectl –∏ Helm
   - Apply Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤
   - Rollout —Å—Ç–∞—Ç—É—Å
   - –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
2. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ UI:**
   - –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è CloudFront
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram

### 6. Code Quality (`code-quality.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push, Pull Request
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)

**–®–∞–≥–∏:**
1. **CodeQL –∞–Ω–∞–ª–∏–∑** ‚Äî JavaScript –∏ Go
2. **Dependency Review** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ PR
3. **SonarCloud** ‚Äî –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
4. **Markdown Lint** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 7. Documentation (`docs.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` (–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docs/**`)
- Manual dispatch

**–®–∞–≥–∏:**
1. **–°–±–æ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   - VitePress build
   - Deploy –≤ GitHub Pages
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI:**
   - Swag –¥–ª—è –≤—Å–µ—Ö Go —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ badges

### 8. Release (`release.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- –¢–µ–≥–∏ `v*.*.*`
- Manual dispatch

**–®–∞–≥–∏:**
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è changelog
   - –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release
2. **–°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è:**
   - Multi-arch Docker –æ–±—Ä–∞–∑—ã (amd64, arm64)
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Docker Hub
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - Telegram –æ –Ω–æ–≤–æ–º —Ä–µ–ª–∏–∑–µ

## üîê –°–µ–∫—Ä–µ—Ç—ã (GitHub Secrets)

### Docker Hub
- `DOCKER_USERNAME` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DOCKER_PASSWORD` ‚Äî —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞

### Kubernetes
- `KUBECONFIG` ‚Äî base64 –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π kubeconfig

### AWS (–¥–ª—è UI deployment)
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `AWS_REGION`
- `ADMIN_PANEL_BUCKET`
- `ADMIN_PANEL_CF_ID`
- `PASSENGER_PORTAL_BUCKET`
- `PASSENGER_PORTAL_CF_ID`
- `BOARD_DISPLAY_BUCKET`
- `BOARD_DISPLAY_CF_ID`

### Database
- `DATABASE_URL` ‚Äî connection string –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

### Notifications
- `TELEGRAM_CHAT_ID` ‚Äî ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### Code Quality
- `CODECOV_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ coverage
- `SONAR_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è SonarCloud

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

Codecov –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 70%
- –û—Ç—á–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PR
- –§–ª–∞–≥–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–ª–∏–∑–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ª–∏–∑

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ–≥:
```bash
git tag v1.0.0
git push origin v1.0.0
```

2. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –°–æ–±–µ—Ä–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
   - –°–æ–∑–¥–∞—Å—Ç Docker –æ–±—Ä–∞–∑—ã
   - –û–ø—É–±–ª–∏–∫—É–µ—Ç GitHub Release
   - –û—Ç–ø—Ä–∞–≤–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions ‚Üí Deploy
2. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
3. –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (staging/production)
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow

## üè∑Ô∏è –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤

–û–±—Ä–∞–∑—ã —Ç–µ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ —Å—Ö–µ–º–µ:
- `latest` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç –≤ main
- `main-<sha>` ‚Äî –∫–æ–º–º–∏—Ç –≤ main
- `develop-<sha>` ‚Äî –∫–æ–º–º–∏—Ç –≤ develop
- `v1.0.0` ‚Äî —Ä–µ–ª–∏–∑–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `1.0` ‚Äî major.minor –≤–µ—Ä—Å–∏—è

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CI/CD

### GitHub Actions Dashboard
```
https://github.com/vokzal-tech/vokzal/actions
```

### Codecov Dashboard
```
https://codecov.io/gh/vokzal-tech/vokzal
```

### SonarCloud Dashboard
```
https://sonarcloud.io/project/overview?id=vokzal-tech_vokzal
```

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ

**Go —Å–µ—Ä–≤–∏—Å—ã:**
```bash
cd services/auth
golangci-lint run
go test -v ./...
```

**UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```bash
cd ui/admin-panel
npm run lint
npm run type-check
npm test
```

### Pre-commit hooks

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pre-commit hooks:
```bash
# Install pre-commit
pip install pre-commit

# Install hooks
pre-commit install

# Run manually
pre-commit run --all-files
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Failed builds

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker –æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è:
```bash
cd services/auth
docker build -t test .
```

### Failed deployments

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ kubeconfig
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å pods:
```bash
kubectl get pods -n vokzal
kubectl logs -f deployment/auth-service -n vokzal
```

### –°–µ–∫—Ä–µ—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ GitHub
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
3. –î–ª—è base64 —Å–µ–∫—Ä–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, KUBECONFIG):
```bash
cat kubeconfig | base64 | pbcopy
```

## üìù Best Practices

1. **–í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ PR** ‚Äî –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –≤ main
2. **–ü–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã** ‚Äî –º–∏–Ω–∏–º—É–º 70% coverage
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–∏–Ω—Ç–µ—Ä—ã** ‚Äî –ø–µ—Ä–µ–¥ push
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ semantic versioning** ‚Äî –¥–ª—è —Ç–µ–≥–æ–≤
5. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏—è –≤ PR** ‚Äî –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ changelog

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Docker Hub](https://hub.docker.com/u/vokzaltech)
- [Kubernetes Documentation](https://kubernetes.io/docs/)
- [Helm Charts](https://helm.sh/docs/)

---

¬© 2026 –í–æ–∫–∑–∞–ª.–¢–ï–•
